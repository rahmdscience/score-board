<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Papan Skor Multi-Olahraga Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --team-a-color: #22d3ee; /* cyan-400 */
        --team-b-color: #fb923c; /* orange-400 */
      }
      body {
        font-family: "Inter", sans-serif;
        touch-action: manipulation;
        background-color: #111827; /* bg-gray-900 */
        color: #e5e7eb; /* text-gray-200 */
      }
      .score-display {
        font-weight: 900;
        font-size: clamp(3.5rem, 20vw, 10rem);
        line-height: 1;
      }
      .timer-display {
        font-weight: 700;
        font-size: clamp(1.75rem, 8vw, 4.5rem);
        font-variant-numeric: tabular-nums;
      }
      .team-name {
        font-size: clamp(1rem, 4vw, 2rem);
        border: 2px solid transparent;
        transition: border-color 0.3s;
      }
      .team-name:focus {
        border-color: #f59e0b;
      }
      .team-name:disabled {
        background-color: transparent;
        cursor: default;
        opacity: 1;
        color: #e5e7eb;
      }
      .btn {
        transition: transform 0.1s ease, background-color 0.2s ease;
      }
      .btn:active {
        transform: scale(0.95);
      }
      .set-score {
        font-size: clamp(1.5rem, 5vw, 2.5rem);
      }
      .tennis-score {
        font-size: clamp(2.5rem, 10vw, 6rem);
      }
      [data-server="true"] {
        color: #34d399;
      }
      .hidden {
        display: none !important;
      }
      .lap-list {
        list-style-type: decimal;
        padding-left: 1.5rem;
        max-height: 100px;
        overflow-y: auto;
        font-variant-numeric: tabular-nums;
      }
      .modal-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 50;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s, visibility 0.3s;
      }
      .modal-backdrop.show {
        opacity: 1;
        visibility: visible;
      }
      .modal-content {
        width: 90%;
        max-width: 450px;
        transform: scale(0.95);
        transition: transform 0.3s;
        background-color: #1f2937; /* bg-gray-800 */
        padding: 1.5rem;
        border-radius: 0.75rem;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      }
      .modal-backdrop.show .modal-content {
        transform: scale(1);
      }
      .country-list,
      .history-list {
        max-height: 300px;
        overflow-y: auto;
      }
      .country-item,
      .history-item {
        cursor: pointer;
        padding: 0.75rem;
        border-radius: 0.5rem;
        transition: background-color 0.2s;
      }
      .country-item:hover,
      .history-item:hover {
        background-color: #374151; /* bg-gray-700 */
      }
      .team-logo {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        object-fit: cover;
      }
    </style>
  </head>
  <body>
    <!-- Sport Selector -->
    <div
      id="sport-selector"
      class="flex flex-col items-center justify-center min-h-screen p-4"
    >
      <h1 class="text-4xl sm:text-6xl font-black text-white">Scoreboard</h1>
      <a
        href="https://www.instagram.com/rahmdsai"
        target="_blank"
        rel="noopener noreferrer"
        class="mt-2 mb-8 p-2 bg-gray-800 text-gray-400 text-xs sm:text-sm rounded-lg hover:bg-gray-700 transition-colors"
      >
        Created by Rahmad Sains
      </a>
      <div
        class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4 w-full max-w-7xl"
      >
        <!-- Sport buttons will be generated by JS -->
      </div>
      <div class="mt-8 flex gap-4">
        <button
          id="history-btn"
          class="btn bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg"
        >
          Riwayat
        </button>
      </div>
      <p id="resume-text" class="mt-8 text-gray-400 hidden">
        Melanjutkan pertandingan terakhir...
      </p>
    </div>

    <!-- Scoreboard Wrapper -->
    <div id="scoreboard-wrapper" class="hidden flex-col min-h-screen">
      <header class="p-3 flex justify-between items-center bg-gray-800/50">
        <button
          id="back-btn"
          class="btn bg-gray-700 hover:bg-gray-600 text-white p-2 rounded-lg"
          title="Kembali"
        >
          <i class="fas fa-arrow-left fa-fw"></i>
        </button>
        <h1
          id="scoreboard-title"
          class="text-xl font-bold text-gray-300 hidden md:block"
        >
          Papan Skor
        </h1>
        <div class="flex gap-2">
          <button
            id="settings-btn"
            class="btn bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-lg"
            title="Pengaturan"
          >
            <i class="fas fa-cog fa-fw"></i>
          </button>
          <button
            id="reset-btn"
            class="btn bg-red-600 hover:bg-red-700 text-white p-2 rounded-lg"
            title="Reset"
          >
            <i class="fas fa-sync fa-fw"></i>
          </button>
        </div>
      </header>

      <main
        class="flex-grow flex flex-col items-center justify-center p-2 sm:p-4"
      >
        <!-- Final Controls -->
        <div id="final-controls" class="mb-4 text-center hidden">
          <h2 class="text-2xl font-bold text-green-500">
            Pertandingan Selesai!
          </h2>
          <button
            id="share-btn"
            class="btn mt-2 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg"
          >
            Bagikan Hasil
          </button>
        </div>

        <!-- Timer & Period Section -->
        <div id="timer-period-section" class="mb-4 text-center">
          <div
            id="period-display-container"
            class="text-lg sm:text-2xl font-bold text-yellow-400 mb-2"
          >
            <span id="period-label">BABAK</span>
            <span id="period-display">1</span>
          </div>
          <div id="timer-display" class="timer-display text-gray-100">
            00:00.00
          </div>
          <div
            id="shot-clock-display"
            class="text-2xl font-bold text-red-500 mt-2 hidden"
          >
            24
          </div>
          <div
            id="timer-controls"
            class="flex justify-center items-center space-x-2 sm:space-x-4 mt-4"
          >
            <button
              id="start-pause-btn"
              class="btn bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg"
            >
              Mulai
            </button>
          </div>
        </div>

        <!-- Sets Display Section -->
        <div id="sets-display-section" class="mb-4 text-center">
          <div class="flex items-center justify-center space-x-4">
            <div class="text-center">
              <div id="team-a-set-name" class="text-sm font-bold text-gray-400">
                TIM A
              </div>
              <div
                id="team-a-sets"
                class="text-4xl font-black"
                style="color: var(--team-a-color)"
              >
                0
              </div>
            </div>
            <div class="text-gray-600 text-4xl font-light">-</div>
            <div class="text-center">
              <div id="team-b-set-name" class="text-sm font-bold text-gray-400">
                TIM B
              </div>
              <div
                id="team-b-sets"
                class="text-4xl font-black"
                style="color: var(--team-b-color)"
              >
                0
              </div>
            </div>
          </div>
          <div id="past-sets-display" class="text-xs text-gray-500 mt-2"></div>
        </div>

        <!-- Scoreboard Section -->
        <div class="w-full grid grid-cols-1 md:grid-cols-2 gap-2 sm:gap-4">
          <!-- Team A -->
          <div
            id="team-a"
            class="bg-gray-800 rounded-xl p-3 sm:p-6 flex flex-col items-center shadow-lg"
          >
            <div class="text-center mb-2 w-full">
              <button
                id="country-btn-a"
                class="btn bg-gray-700 hover:bg-gray-600 rounded-lg p-2 w-full flex items-center justify-center gap-2 mb-2"
              >
                <img id="logo-a" class="team-logo hidden" />
                <span id="flag-a">üè¥</span>
                <span id="country-name-a">Tim Kustom</span>
              </button>
              <div class="flex items-center gap-2">
                <input
                  id="team-a-name"
                  type="text"
                  value="TIM A"
                  class="team-name bg-transparent text-center font-bold uppercase w-full rounded-md p-2 focus:outline-none"
                />
                <i id="server-a" class="fas" data-server="false"></i>
              </div>
            </div>
            <div
              id="score-a"
              class="score-display my-4"
              style="color: var(--team-a-color)"
            >
              0
            </div>
            <div
              id="points-controls-a"
              class="grid grid-cols-3 gap-2 w-full mb-4"
            ></div>
            <div
              id="extra-info-a"
              class="w-full flex flex-col items-center justify-center gap-2 bg-gray-900/50 p-2 rounded-lg"
            ></div>
          </div>

          <!-- Team B -->
          <div
            id="team-b"
            class="bg-gray-800 rounded-xl p-3 sm:p-6 flex flex-col items-center shadow-lg"
          >
            <div class="text-center mb-2 w-full">
              <button
                id="country-btn-b"
                class="btn bg-gray-700 hover:bg-gray-600 rounded-lg p-2 w-full flex items-center justify-center gap-2 mb-2"
              >
                <img id="logo-b" class="team-logo hidden" />
                <span id="flag-b">üè¥</span>
                <span id="country-name-b">Tim Kustom</span>
              </button>
              <div class="flex items-center gap-2">
                <input
                  id="team-b-name"
                  type="text"
                  value="TIM B"
                  class="team-name bg-transparent text-center font-bold uppercase w-full rounded-md p-2 focus:outline-none"
                />
                <i id="server-b" class="fas" data-server="false"></i>
              </div>
            </div>
            <div
              id="score-b"
              class="score-display my-4"
              style="color: var(--team-b-color)"
            >
              0
            </div>
            <div
              id="points-controls-b"
              class="grid grid-cols-3 gap-2 w-full mb-4"
            ></div>
            <div
              id="extra-info-b"
              class="w-full flex flex-col items-center justify-center gap-2 bg-gray-900/50 p-2 rounded-lg"
            ></div>
          </div>
        </div>
      </main>
    </div>

    <!-- Modals -->
    <div id="country-modal" class="modal-backdrop">
      <div class="modal-content">
        <h2 class="text-xl font-bold mb-4">Pilih Negara</h2>
        <input
          type="text"
          id="country-search"
          class="w-full p-2 rounded-md bg-gray-700 border border-gray-600 mb-4"
          placeholder="Cari negara..."
        />
        <div id="country-list" class="country-list space-y-1"></div>
      </div>
    </div>
    <div id="confirm-modal" class="modal-backdrop">
      <div class="modal-content text-center">
        <h2 id="confirm-title" class="text-2xl font-bold mb-4">Anda Yakin?</h2>
        <p id="confirm-text" class="text-gray-300 mb-6">
          Tindakan ini tidak dapat diurungkan.
        </p>
        <div class="flex justify-center space-x-4">
          <button
            id="confirm-cancel-btn"
            class="btn bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg"
          >
            Batal
          </button>
          <button
            id="confirm-ok-btn"
            class="btn bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-lg"
          >
            Ya, Lanjutkan
          </button>
        </div>
      </div>
    </div>
    <div id="settings-modal" class="modal-backdrop">
      <div class="modal-content">
        <h2 class="text-xl font-bold mb-6">Pengaturan Pertandingan</h2>
        <div id="settings-content" class="space-y-4"></div>
        <div class="flex justify-end space-x-4 mt-8">
          <button
            id="settings-cancel-btn"
            class="btn bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg"
          >
            Batal
          </button>
          <button
            id="settings-save-btn"
            class="btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg"
          >
            Simpan
          </button>
        </div>
      </div>
    </div>
    <div id="history-modal" class="modal-backdrop">
      <div class="modal-content">
        <h2 class="text-xl font-bold mb-4">Riwayat Pertandingan</h2>
        <div id="history-list" class="history-list space-y-2"></div>
        <div class="flex justify-end mt-4">
          <button
            id="history-close-btn"
            class="btn bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg"
          >
            Tutup
          </button>
        </div>
      </div>
    </div>
    <div id="share-modal" class="modal-backdrop">
      <div class="modal-content text-center">
        <h2 class="text-xl font-bold mb-4">Bagikan Hasil</h2>
        <div id="share-preview" class="p-4 rounded-lg bg-gray-700 mb-4"></div>
        <div class="flex flex-col sm:flex-row justify-center gap-4">
          <button
            id="share-download-btn"
            class="btn bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg"
          >
            Unduh Gambar
          </button>
          <button
            id="share-copy-btn"
            class="btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg"
          >
            Salin Teks
          </button>
          <button
            id="share-close-btn"
            class="btn bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg"
          >
            Tutup
          </button>
        </div>
      </div>
    </div>

    <!-- Share Preview Template (Hidden) -->
    <div
      id="share-template"
      class="p-8 bg-gray-800 text-white rounded-lg shadow-xl hidden"
      style="width: 500px"
    >
      <h2
        id="share-template-title"
        class="text-3xl font-black text-center mb-2"
      >
        HASIL PERTANDINGAN
      </h2>
      <p
        id="share-template-sport"
        class="text-center text-yellow-400 font-bold text-lg mb-6"
      ></p>
      <div class="grid grid-cols-2 gap-4 items-center">
        <div id="share-template-team-a" class="text-center">
          <img
            id="share-template-logo-a"
            class="w-20 h-20 rounded-full mx-auto mb-2 object-cover border-4 border-cyan-400"
          />
          <p id="share-template-name-a" class="text-2xl font-bold"></p>
          <p
            id="share-template-sets-a"
            class="text-5xl font-black text-cyan-400"
          ></p>
        </div>
        <div id="share-template-team-b" class="text-center">
          <img
            id="share-template-logo-b"
            class="w-20 h-20 rounded-full mx-auto mb-2 object-cover border-4 border-orange-400"
          />
          <p id="share-template-name-b" class="text-2xl font-bold"></p>
          <p
            id="share-template-sets-b"
            class="text-5xl font-black text-orange-400"
          ></p>
        </div>
      </div>
      <p
        id="share-template-final-score"
        class="text-center text-gray-400 text-sm mt-4"
      ></p>
    </div>

    <script>
      // --- DATA & CONFIGURATION ---
      const countries = {
        CUSTOM: { name: "Tim Kustom", flag: "üè¥" },
        ID: { name: "Indonesia", flag: "üáÆüá©" },
        US: { name: "USA", flag: "üá∫üá∏" },
        GB: { name: "UK", flag: "üá¨üáß" },
        CN: { name: "China", flag: "üá®üá≥" },
        JP: { name: "Jepang", flag: "üáØüáµ" },
        KR: { name: "Korea Selatan", flag: "ÔøΩüá∑" },
        DE: { name: "Jerman", flag: "üá©üá™" },
        FR: { name: "Prancis", flag: "üá´üá∑" },
        BR: { name: "Brazil", flag: "üáßüá∑" },
        IN: { name: "India", flag: "üáÆüá≥" },
        AU: { name: "Australia", flag: "üá¶üá∫" },
        CA: { name: "Kanada", flag: "üá®üá¶" },
        RU: { name: "Rusia", flag: "üá∑üá∫" },
        IT: { name: "Italia", flag: "üáÆüáπ" },
        ES: { name: "Spanyol", flag: "üá™üá∏" },
        MX: { name: "Meksiko", flag: "üá≤üáΩ" },
        AR: { name: "Argentina", flag: "üá¶üá∑" },
        NL: { name: "Belanda", flag: "üá≥üá±" },
        TR: { name: "Turki", flag: "üáπüá∑" },
        MY: { name: "Malaysia", flag: "üá≤üáæ" },
        TH: { name: "Thailand", flag: "üáπüá≠" },
        VN: { name: "Vietnam", flag: "üáªüá≥" },
        PH: { name: "Filipina", flag: "üáµüá≠" },
        SG: { name: "Singapura", flag: "üá∏üá¨" },
      };
      const sportConfigs = {
        basketball: {
          title: "Basket",
          icon: "fa-basketball",
          hasTimer: true,
          hasFouls: true,
          points: [1, 2, 3],
          periods: { label: "KUARTER", count: 4 },
          timerDuration: 12 * 60,
        },
        football: {
          title: "Sepak Bola",
          icon: "fa-futbol",
          hasTimer: true,
          points: [1],
          periods: { label: "BABAK", count: 2 },
          timerDuration: 45 * 60,
        },
        badminton: {
          title: "Bulu Tangkis",
          icon: "fa-shuttlecock",
          hasSets: true,
          hasServer: true,
          points: [1],
          sets: { toWin: 2, points: 21, winBy: 2 },
        },
        volleyball: {
          title: "Bola Voli",
          icon: "fa-volleyball",
          hasSets: true,
          hasServer: true,
          hasTimeouts: true,
          points: [1],
          sets: { toWin: 3, points: 25, winBy: 2, finalPoints: 15 },
        },
        tennis: {
          title: "Tenis",
          icon: "fa-baseball-ball",
          hasSets: true,
          hasServer: true,
          isTennis: true,
          points: [1],
          sets: { toWin: 2 },
          tennisPoints: ["0", "15", "30", "40", "AD"],
        },
        running: {
          title: "Lari",
          icon: "fa-person-running",
          hasTimer: true,
          stopwatch: true,
          hasLaps: true,
        },
      };

      // --- SOUNDS ---
      const sounds = {
        buzzer: new Tone.Synth({
          oscillator: { type: "square" },
          envelope: { attack: 0.01, decay: 0.5, sustain: 0.2, release: 0.1 },
        }).toDestination(),
        score: new Tone.Synth({
          oscillator: { type: "sine" },
          envelope: { attack: 0.001, decay: 0.1, sustain: 0.1, release: 0.1 },
        }).toDestination(),
        click: new Tone.MembraneSynth({
          octaves: 4,
          pitchDecay: 0.1,
        }).toDestination(),
        warning: new Tone.Synth({
          oscillator: { type: "triangle" },
          envelope: { attack: 0.01, decay: 0.2, sustain: 0.1, release: 0.1 },
        }).toDestination(),
      };
      let audioReady = false;
      function playSound(sound) {
        if (!audioReady) {
          Tone.start();
          audioReady = true;
        }
        switch (sound) {
          case "buzzer":
            sounds.buzzer.triggerAttackRelease("C4", "0.5s");
            break;
          case "score":
            sounds.score.triggerAttackRelease("C6", "0.1s");
            break;
          case "click":
            sounds.click.triggerAttackRelease("C2", "8n");
            break;
          case "warning":
            sounds.warning.triggerAttackRelease("G4", "0.2s");
            break;
        }
      }

      // --- STATE MANAGEMENT ---
      let state = {};
      let timerInterval = null,
        shotClockInterval = null;
      let activeCountryTeam = null,
        confirmCallback = null;

      // --- DOM ELEMENTS ---
      const sportSelector = document.getElementById("sport-selector");
      const scoreboardWrapper = document.getElementById("scoreboard-wrapper");
      const countryModal = document.getElementById("country-modal");
      const confirmModal = document.getElementById("confirm-modal");
      const settingsModal = document.getElementById("settings-modal");
      const historyModal = document.getElementById("history-modal");
      const shareModal = document.getElementById("share-modal");

      // --- CORE FUNCTIONS ---
      function saveState() {
        localStorage.setItem("scoreboardState", JSON.stringify(state));
      }
      function loadState() {
        const saved = localStorage.getItem("scoreboardState");
        if (saved) {
          state = JSON.parse(saved);
          state.timerRunning = false;
          return true;
        }
        return false;
      }

      function selectSport(sport) {
        playSound("click");
        if (!sport) return;

        // FIX: Logic to decide whether to resume or start new
        const lastSavedSport = state.sport;
        if (sport !== lastSavedSport) {
          initState(sport);
        }

        setupUI(sport);
        updateFullUI();
        sportSelector.classList.add("hidden");
        scoreboardWrapper.classList.remove("hidden");
        scoreboardWrapper.classList.add("flex");
      }

      function goBack() {
        playSound("click");
        clearInterval(timerInterval);
        clearInterval(shotClockInterval);
        scoreboardWrapper.classList.add("hidden");
        scoreboardWrapper.classList.remove("flex");
        sportSelector.classList.remove("hidden");
        // Refresh the resume text on the main page
        const resumeText = document.getElementById("resume-text");
        if (state.sport) {
          resumeText.textContent = `Pertandingan terakhir (${
            sportConfigs[state.sport].title
          }) siap dilanjutkan.`;
          resumeText.classList.remove("hidden");
        } else {
          resumeText.classList.add("hidden");
        }
      }

      function initState(sport) {
        const config = sportConfigs[sport];
        state = {
          sport: sport,
          teamAName: "TIM A",
          teamBName: "TIM B",
          countryA: "CUSTOM",
          countryB: "CUSTOM",
          logoA: null,
          logoB: null,
          colorA: "#22d3ee",
          colorB: "#fb923c",
          scoreA: 0,
          scoreB: 0,
          period: 1,
          timerMilliseconds: config.timerDuration
            ? config.timerDuration * 1000
            : 0,
          shotClockMilliseconds: 24 * 1000,
          timerRunning: false,
          matchOver: false,
          setsA: 0,
          setsB: 0,
          pastSets: [],
          server: "a",
          foulsA: 0,
          foulsB: 0,
          timeoutsA: 3,
          timeoutsB: 3,
          gameScoreA: 0,
          gameScoreB: 0,
          lapsA: [],
          lapsB: [],
          // Advanced settings
          adv_setsToWin: config.sets?.toWin || 2,
          adv_pointsToWin: config.sets?.points || 21,
          adv_showShotClock: false,
        };
      }

      // --- UI SETUP & UPDATES ---
      function setupUI(sport) {
        const config = sportConfigs[sport];
        document.getElementById(
          "scoreboard-title"
        ).textContent = `Papan Skor ${config.title}`;
        document
          .getElementById("timer-period-section")
          .classList.toggle("hidden", !config.hasTimer);
        document
          .getElementById("sets-display-section")
          .classList.toggle("hidden", !config.hasSets);

        const serverA = document.getElementById("server-a");
        const serverB = document.getElementById("server-b");
        serverA.classList.toggle("hidden", !config.hasServer);
        serverB.classList.toggle("hidden", !config.hasServer);
        if (config.hasServer) {
          const serverIconClass = config.icon || "fa-circle";
          serverA.className = `fas ${serverIconClass}`;
          serverB.className = `fas ${serverIconClass}`;
        }

        const pointsControlsA = document.getElementById("points-controls-a"),
          pointsControlsB = document.getElementById("points-controls-b"),
          extraInfoA = document.getElementById("extra-info-a"),
          extraInfoB = document.getElementById("extra-info-b");
        pointsControlsA.innerHTML = "";
        pointsControlsB.innerHTML = "";
        extraInfoA.innerHTML = "";
        extraInfoB.innerHTML = "";

        if (config.points) {
          config.points.forEach((p) => {
            pointsControlsA.innerHTML += `<button onclick="addScore('a', ${p})" class="btn text-white font-bold py-3 rounded-lg text-lg" style="background-color: var(--team-a-color);">+${p}</button>`;
            pointsControlsB.innerHTML += `<button onclick="addScore('b', ${p})" class="btn text-white font-bold py-3 rounded-lg text-lg" style="background-color: var(--team-b-color);">+${p}</button>`;
          });
        }
        if (config.hasLaps) {
          pointsControlsA.innerHTML = `<button onclick="recordLap('a')" class="btn text-white font-bold py-3 rounded-lg text-lg col-span-3" style="background-color: var(--team-a-color);">Catat Lap</button>`;
          pointsControlsB.innerHTML = `<button onclick="recordLap('b')" class="btn text-white font-bold py-3 rounded-lg text-lg col-span-3" style="background-color: var(--team-b-color);">Catat Lap</button>`;
        }

        if (config.hasFouls) {
          extraInfoA.innerHTML += `<div class="flex items-center justify-center gap-4"><span class="font-bold text-lg">FOUL</span><span id="foul-a-display" class="font-black text-4xl text-red-500">0</span><button onclick="addFoul('a')" class="btn bg-red-500 hover:bg-red-600 text-white font-bold h-10 w-10 rounded-full text-lg">+</button></div>`;
          extraInfoB.innerHTML += `<div class="flex items-center justify-center gap-4"><span class="font-bold text-lg">FOUL</span><span id="foul-b-display" class="font-black text-4xl text-red-500">0</span><button onclick="addFoul('b')" class="btn bg-red-500 hover:bg-red-600 text-white font-bold h-10 w-10 rounded-full text-lg">+</button></div>`;
        }
        if (config.hasTimeouts) {
          extraInfoA.innerHTML += `<div class="flex items-center justify-center gap-4 mt-2"><span class="font-bold text-lg">TIMEOUT</span><span id="timeout-a-display" class="font-black text-4xl text-yellow-400">3</span><button onclick="useTimeout('a')" class="btn bg-yellow-500 hover:bg-yellow-600 text-white font-bold h-10 w-10 rounded-full text-lg">-</button></div>`;
          extraInfoB.innerHTML += `<div class="flex items-center justify-center gap-4 mt-2"><span class="font-bold text-lg">TIMEOUT</span><span id="timeout-b-display" class="font-black text-4xl text-yellow-400">3</span><button onclick="useTimeout('b')" class="btn bg-yellow-500 hover:bg-yellow-600 text-white font-bold h-10 w-10 rounded-full text-lg">-</button></div>`;
        }
        if (config.hasLaps) {
          extraInfoA.innerHTML = `<div class="text-left w-full"><h3 class="font-bold mb-1">Lap A:</h3><ol id="lap-list-a" class="lap-list"></ol></div>`;
          extraInfoB.innerHTML = `<div class="text-left w-full"><h3 class="font-bold mb-1">Lap B:</h3><ol id="lap-list-b" class="lap-list"></ol></div>`;
        }

        if (config.periods)
          document.getElementById("period-label").textContent =
            config.periods.label;
        document
          .getElementById("score-a")
          .classList.toggle("tennis-score", !!config.isTennis);
        document
          .getElementById("score-b")
          .classList.toggle("tennis-score", !!config.isTennis);
        document
          .getElementById("score-a")
          .classList.toggle("timer-display", !!config.stopwatch);
        document
          .getElementById("score-b")
          .classList.toggle("timer-display", !!config.stopwatch);
        // FIX: Hide score display for running
        document
          .getElementById("score-a")
          .classList.toggle("hidden", sport === "running");
        document
          .getElementById("score-b")
          .classList.toggle("hidden", sport === "running");
      }

      function updateFullUI() {
        if (!state.sport) return;
        const config = sportConfigs[state.sport];
        const root = document.documentElement;
        root.style.setProperty("--team-a-color", state.colorA);
        root.style.setProperty("--team-b-color", state.colorB);

        const teamANameEl = document.getElementById("team-a-name"),
          teamBNameEl = document.getElementById("team-b-name");
        teamANameEl.value = state.teamAName;
        teamBNameEl.value = state.teamBName;
        teamANameEl.disabled = state.countryA !== "CUSTOM";
        teamBNameEl.disabled = state.countryB !== "CUSTOM";

        document.getElementById("flag-a").textContent =
          countries[state.countryA].flag;
        document.getElementById("country-name-a").textContent =
          countries[state.countryA].name;
        document.getElementById("flag-b").textContent =
          countries[state.countryB].flag;
        document.getElementById("country-name-b").textContent =
          countries[state.countryB].name;

        const logoA = document.getElementById("logo-a"),
          logoB = document.getElementById("logo-b");
        logoA.src = state.logoA;
        logoB.src = state.logoB;
        logoA.classList.toggle("hidden", !state.logoA);
        logoB.classList.toggle("hidden", !state.logoB);
        document
          .getElementById("flag-a")
          .classList.toggle("hidden", !!state.logoA);
        document
          .getElementById("flag-b")
          .classList.toggle("hidden", !!state.logoB);

        if (config.isTennis) {
          document.getElementById("score-a").textContent =
            config.tennisPoints[state.gameScoreA];
          document.getElementById("score-b").textContent =
            config.tennisPoints[state.gameScoreB];
        } else if (config.stopwatch) {
          /* Score is hidden for running */
        } else {
          document.getElementById("score-a").textContent = state.scoreA;
          document.getElementById("score-b").textContent = state.scoreB;
        }

        if (config.hasTimer) {
          document.getElementById("timer-display").textContent = formatTime(
            state.timerMilliseconds
          );
          if (!config.stopwatch)
            document.getElementById("period-display").textContent =
              state.period;
          document.getElementById("start-pause-btn").textContent =
            state.timerRunning ? "Jeda" : "Mulai";
        }
        document
          .getElementById("shot-clock-display")
          .classList.toggle("hidden", !state.adv_showShotClock);
        if (state.adv_showShotClock)
          document.getElementById("shot-clock-display").textContent = Math.ceil(
            state.shotClockMilliseconds / 1000
          );

        if (config.hasSets) {
          document.getElementById("team-a-set-name").textContent =
            state.teamAName;
          document.getElementById("team-b-set-name").textContent =
            state.teamBName;
          document.getElementById("team-a-sets").textContent = state.setsA;
          document.getElementById("team-b-sets").textContent = state.setsB;
          document.getElementById("past-sets-display").textContent =
            state.pastSets.map((s) => `${s.a}-${s.b}`).join(" , ");
        }
        if (config.hasServer) {
          document.getElementById("server-a").dataset.server =
            state.server === "a";
          document.getElementById("server-b").dataset.server =
            state.server === "b";
        }
        if (config.hasFouls) {
          document.getElementById("foul-a-display").textContent = state.foulsA;
          document.getElementById("foul-b-display").textContent = state.foulsB;
        }
        if (config.hasTimeouts) {
          document.getElementById("timeout-a-display").textContent =
            state.timeoutsA;
          document.getElementById("timeout-b-display").textContent =
            state.timeoutsB;
        }
        if (config.hasLaps) {
          document.getElementById("lap-list-a").innerHTML = state.lapsA
            .map((lap) => `<li>${formatTime(lap)}</li>`)
            .join("");
          document.getElementById("lap-list-b").innerHTML = state.lapsB
            .map((lap) => `<li>${formatTime(lap)}</li>`)
            .join("");
        }

        document
          .getElementById("final-controls")
          .classList.toggle("hidden", !state.matchOver);
        saveState();
      }

      // --- GAME LOGIC ---
      function formatTime(ms) {
        if (ms < 0) ms = 0;
        const m = Math.floor(ms / 60000);
        const s = Math.floor((ms % 60000) / 1000);
        const m_s = Math.floor((ms % 1000) / 10);
        return `${String(m).padStart(2, "0")}:${String(s).padStart(
          2,
          "0"
        )}.${String(m_s).padStart(2, "0")}`;
      }

      function addScore(team, points) {
        if (state.matchOver) return;
        playSound("score");
        const config = sportConfigs[state.sport];
        if (config.isTennis) handleTennisPoint(team);
        else {
          if (team === "a") state.scoreA += points;
          else state.scoreB += points;
          if (config.hasSets) checkSetWin();
        }
        if (state.adv_showShotClock) state.shotClockMilliseconds = 24 * 1000;
        updateFullUI();
      }

      function checkSetWin() {
        const config = sportConfigs[state.sport].sets;
        const scoreA = state.scoreA,
          scoreB = state.scoreB;
        const targetPoints = state.adv_pointsToWin;
        let winner = null;
        if (scoreA >= targetPoints && scoreA >= scoreB + config.winBy)
          winner = "a";
        else if (scoreB >= targetPoints && scoreB >= scoreA + config.winBy)
          winner = "b";
        if (winner) {
          if (winner === "a") state.setsA++;
          else state.setsB++;
          state.pastSets.push({ a: scoreA, b: scoreB });
          state.scoreA = 0;
          state.scoreB = 0;
          state.server = state.server === "a" ? "b" : "a";
          if (
            state.setsA === state.adv_setsToWin ||
            state.setsB === state.adv_setsToWin
          ) {
            endMatch();
          }
        }
      }

      function handleTennisPoint(team) {
        let scorer = team === "a" ? "gameScoreA" : "gameScoreB";
        let other = team === "a" ? "gameScoreB" : "gameScoreA";
        if (state[scorer] < 3) {
          state[scorer]++;
        } else if (state[scorer] === 3) {
          if (state[other] < 3) handleTennisGameWin(team);
          else if (state[other] === 3) state[scorer]++;
          else state[other]--;
        } else if (state[scorer] === 4) {
          handleTennisGameWin(team);
        }
      }

      function handleTennisGameWin(team) {
        if (team === "a") state.scoreA++;
        else state.scoreB++;
        state.gameScoreA = 0;
        state.gameScoreB = 0;
        state.server = state.server === "a" ? "b" : "a";
        if (
          (state.scoreA >= 6 && state.scoreA >= state.scoreB + 2) ||
          (state.scoreB >= 6 && state.scoreB >= state.scoreA + 2)
        ) {
          const winner = state.scoreA > state.scoreB ? "a" : "b";
          if (winner === "a") state.setsA++;
          else state.setsB++;
          state.pastSets.push({ a: state.scoreA, b: state.scoreB });
          state.scoreA = 0;
          state.scoreB = 0;
          // FIX: Check for match win after a set is won in tennis
          if (
            state.setsA === state.adv_setsToWin ||
            state.setsB === state.adv_setsToWin
          ) {
            endMatch();
          }
        }
      }

      function endMatch() {
        playSound("buzzer");
        state.matchOver = true;
        clearInterval(timerInterval);
        clearInterval(shotClockInterval);
        state.timerRunning = false;
        saveMatchToHistory();
        updateFullUI();
      }

      function addFoul(team) {
        if (state.matchOver) return;
        playSound("click");
        if (team === "a") state.foulsA++;
        else state.foulsB++;
        updateFullUI();
      }
      function recordLap(team) {
        if (!state.timerRunning) return;
        playSound("click");
        if (team === "a") state.lapsA.push(state.timerMilliseconds);
        else state.lapsB.push(state.timerMilliseconds);
        updateFullUI();
      }
      function useTimeout(team) {
        if (state.matchOver) return;
        playSound("click");
        if (team === "a" && state.timeoutsA > 0) state.timeoutsA--;
        else if (team === "b" && state.timeoutsB > 0) state.timeoutsB--;
        updateFullUI();
      }
      function toggleTimer() {
        if (state.matchOver) return;
        playSound("click");
        const config = sportConfigs[state.sport];
        const updateInterval = 11;
        if (state.timerRunning) {
          clearInterval(timerInterval);
          clearInterval(shotClockInterval);
          state.timerRunning = false;
        } else {
          if (!audioReady) {
            Tone.start();
            audioReady = true;
          }
          state.timerRunning = true;
          const timerFn = () => {
            if (config.stopwatch) state.timerMilliseconds += updateInterval;
            else {
              if (state.timerMilliseconds > updateInterval)
                state.timerMilliseconds -= updateInterval;
              else {
                state.timerMilliseconds = 0;
                endMatch();
              }
            }
          };
          const shotClockFn = () => {
            if (state.shotClockMilliseconds > 0)
              state.shotClockMilliseconds -= updateInterval;
            else {
              state.shotClockMilliseconds = 0;
              playSound("buzzer");
            }
          };
          timerInterval = setInterval(() => {
            timerFn();
            updateFullUI();
          }, updateInterval);
          if (state.adv_showShotClock)
            shotClockInterval = setInterval(shotClockFn, updateInterval);
        }
        updateFullUI();
      }

      // --- MODALS & HISTORY & SHARE ---
      function showModal(modal) {
        modal.classList.add("show");
      }
      function closeModal(modal) {
        modal.classList.remove("show");
      }
      function showConfirmationModal(options) {
        playSound("warning");
        document.getElementById("confirm-title").textContent =
          options.title || "Anda Yakin?";
        document.getElementById("confirm-text").textContent =
          options.text || "Tindakan ini tidak dapat diurungkan.";
        confirmCallback = options.onConfirm;
        showModal(confirmModal);
      }

      function openCountryModal(team) {
        activeCountryTeam = team;
        populateCountryList();
        showModal(countryModal);
        document.getElementById("country-search").focus();
      }

      function populateCountryList(filter = "") {
        const listEl = document.getElementById("country-list");
        listEl.innerHTML = "";
        const lowerFilter = filter.toLowerCase();
        for (const code in countries) {
          const country = countries[code];
          if (country.name.toLowerCase().includes(lowerFilter)) {
            const item = document.createElement("div");
            item.className = "country-item flex items-center gap-4";
            item.innerHTML = `<span class="text-2xl">${country.flag}</span><span class="font-semibold">${country.name}</span>`;
            item.onclick = () => selectCountry(code);
            listEl.appendChild(item);
          }
        }
      }

      function selectCountry(countryCode) {
        const teamKey = activeCountryTeam === "a" ? "A" : "B";
        state[`country${teamKey}`] = countryCode;
        if (countryCode !== "CUSTOM") {
          state[`team${teamKey}Name`] =
            countries[countryCode].name.toUpperCase();
        }
        closeModal(countryModal);
        updateFullUI();
      }

      function openSettingsModal() {
        playSound("click");
        const content = document.getElementById("settings-content");
        const config = sportConfigs[state.sport];
        let html = `
            <h3 class="text-lg font-bold border-b border-gray-600 pb-2 mb-4">Kustomisasi Tim</h3>
            <div class="grid grid-cols-2 gap-4">
                <div><label class="block text-sm font-medium mb-1">Warna Tim A</label><input type="color" id="color-a-input" value="${state.colorA}" class="w-full h-10 p-1 rounded-md"></div>
                <div><label class="block text-sm font-medium mb-1">Warna Tim B</label><input type="color" id="color-b-input" value="${state.colorB}" class="w-full h-10 p-1 rounded-md"></div>
                <div><label class="block text-sm font-medium mb-1">Logo Tim A</label><input type="file" id="logo-a-input" class="text-sm"></div>
                <div><label class="block text-sm font-medium mb-1">Logo Tim B</label><input type="file" id="logo-b-input" class="text-sm"></div>
            </div>
            <h3 class="text-lg font-bold border-b border-gray-600 pb-2 mb-4 mt-6">Aturan Main</h3>
        `;
        if (config.isTennis)
          html += `<div><label class="block text-sm font-medium">Jumlah Set</label><select id="adv-sets-input" class="w-full p-2 rounded-md bg-gray-700 mt-1"><option value="2">Best of 3</option><option value="3">Best of 5</option></select></div>`;
        if (config.title === "Bulu Tangkis" || config.title === "Bola Voli")
          html += `<div><label class="block text-sm font-medium">Poin Kemenangan per Set</label><input type="number" id="adv-points-input" value="${state.adv_pointsToWin}" class="w-full p-2 rounded-md bg-gray-700 mt-1"></div>`;
        if (config.title === "Basket")
          html += `<div class="flex items-center gap-2"><input type="checkbox" id="adv-shotclock-input" ${
            state.adv_showShotClock ? "checked" : ""
          }><label for="adv-shotclock-input">Tampilkan Shot Clock</label></div>`;
        content.innerHTML = html;
        if (config.isTennis)
          document.getElementById("adv-sets-input").value = state.adv_setsToWin;
        showModal(settingsModal);
      }

      function saveSettings() {
        playSound("click");
        state.colorA = document.getElementById("color-a-input").value;
        state.colorB = document.getElementById("color-b-input").value;
        const logoAFile = document.getElementById("logo-a-input").files[0];
        const logoBFile = document.getElementById("logo-b-input").files[0];
        const readerA = new FileReader();
        const readerB = new FileReader();
        if (logoAFile) {
          readerA.onload = (e) => {
            state.logoA = e.target.result;
            updateFullUI();
          };
          readerA.readAsDataURL(logoAFile);
        }
        if (logoBFile) {
          readerB.onload = (e) => {
            state.logoB = e.target.result;
            updateFullUI();
          };
          readerB.readAsDataURL(logoBFile);
        }

        if (document.getElementById("adv-sets-input"))
          state.adv_setsToWin = parseInt(
            document.getElementById("adv-sets-input").value
          );
        if (document.getElementById("adv-points-input"))
          state.adv_pointsToWin = parseInt(
            document.getElementById("adv-points-input").value
          );
        if (document.getElementById("adv-shotclock-input"))
          state.adv_showShotClock = document.getElementById(
            "adv-shotclock-input"
          ).checked;

        closeModal(settingsModal);
        updateFullUI();
      }

      function saveMatchToHistory() {
        let history = JSON.parse(localStorage.getItem("matchHistory") || "[]");
        const finalScore = sportConfigs[state.sport].hasSets
          ? `${state.setsA} - ${state.setsB}`
          : `${state.scoreA} - ${state.scoreB}`;
        history.unshift({
          sport: state.sport,
          teamAName: state.teamAName,
          teamBName: state.teamBName,
          logoA: state.logoA,
          logoB: state.logoB,
          colorA: state.colorA,
          colorB: state.colorB,
          finalScore: finalScore,
          pastSets: state.pastSets,
          date: new Date().toLocaleString("id-ID"),
        });
        if (history.length > 20) history.pop(); // Keep last 20 matches
        localStorage.setItem("matchHistory", JSON.stringify(history));
      }

      function openHistoryModal() {
        playSound("click");
        let history = JSON.parse(localStorage.getItem("matchHistory") || "[]");
        const listEl = document.getElementById("history-list");
        if (history.length === 0) {
          listEl.innerHTML = `<p class="text-center text-gray-500">Belum ada riwayat pertandingan.</p>`;
        } else {
          listEl.innerHTML = history
            .map(
              (match) => `
                <div class="history-item bg-gray-700 p-3 rounded-lg">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-bold text-sm">${
                          sportConfigs[match.sport].title
                        }</span>
                        <span class="text-xs text-gray-500">${match.date}</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="font-semibold" style="color:${
                          match.colorA
                        }">${match.teamAName}</span>
                        <span class="font-black text-xl">${
                          match.finalScore
                        }</span>
                        <span class="font-semibold" style="color:${
                          match.colorB
                        }">${match.teamBName}</span>
                    </div>
                </div>
            `
            )
            .join("");
        }
        showModal(historyModal);
      }

      function openShareModal() {
        playSound("click");
        const t = {
          title: document.getElementById("share-template-title"),
          sport: document.getElementById("share-template-sport"),
          logoA: document.getElementById("share-template-logo-a"),
          nameA: document.getElementById("share-template-name-a"),
          setsA: document.getElementById("share-template-sets-a"),
          logoB: document.getElementById("share-template-logo-b"),
          nameB: document.getElementById("share-template-name-b"),
          setsB: document.getElementById("share-template-sets-b"),
          finalScore: document.getElementById("share-template-final-score"),
        };
        const config = sportConfigs[state.sport];
        t.sport.textContent = config.title.toUpperCase();
        t.logoA.src =
          state.logoA || "https://placehold.co/128x128/1f2937/22d3ee?text=?";
        t.nameA.textContent = state.teamAName;
        t.logoB.src =
          state.logoB || "https://placehold.co/128x128/1f2937/fb923c?text=?";
        t.nameB.textContent = state.teamBName;
        if (config.hasSets) {
          t.setsA.textContent = state.setsA;
          t.setsB.textContent = state.setsB;
          t.finalScore.textContent = `Skor Set: ${state.pastSets
            .map((s) => `${s.a}-${s.b}`)
            .join(", ")}`;
        } else {
          t.setsA.textContent = state.scoreA;
          t.setsB.textContent = state.scoreB;
          t.finalScore.textContent = "";
        }

        const templateNode = document.getElementById("share-template");
        templateNode.classList.remove("hidden");
        html2canvas(templateNode).then((canvas) => {
          templateNode.classList.add("hidden");
          const previewContainer = document.getElementById("share-preview");
          canvas.style.width = "100%";
          canvas.style.height = "auto";
          canvas.style.borderRadius = "0.5rem";
          previewContainer.innerHTML = "";
          previewContainer.appendChild(canvas);
          document.getElementById("share-download-btn").onclick = () => {
            playSound("click");
            const link = document.createElement("a");
            link.download = `hasil_${state.teamAName}_vs_${state.teamBName}.png`;
            link.href = canvas.toDataURL();
            link.click();
          };
        });
        showModal(shareModal);
      }

      // --- EVENT LISTENERS & INITIAL LOAD ---
      document.addEventListener("DOMContentLoaded", () => {
        // Main screen
        const sportSelectorGrid = document.querySelector(
          "#sport-selector .grid"
        );
        for (const sportKey in sportConfigs) {
          const config = sportConfigs[sportKey];
          sportSelectorGrid.innerHTML += `<button data-sport="${sportKey}" class="sport-btn btn bg-gray-800 text-white hover:bg-gray-700 shadow-md p-4 sm:p-6 rounded-xl flex flex-col items-center justify-center aspect-square"> <i class="fas ${config.icon} fa-3x mb-4 text-gray-500"></i> <span class="text-lg sm:text-xl font-bold">${config.title}</span> </button>`;
        }
        document
          .querySelectorAll(".sport-btn")
          .forEach((btn) =>
            btn.addEventListener("click", () => selectSport(btn.dataset.sport))
          );
        document
          .getElementById("history-btn")
          .addEventListener("click", openHistoryModal);

        // Scoreboard screen
        document.getElementById("back-btn").addEventListener("click", goBack);
        document.getElementById("reset-btn").addEventListener("click", () =>
          showConfirmationModal({
            title: "Reset Pertandingan?",
            text: "Semua skor, waktu, dan pengaturan akan kembali ke awal.",
            onConfirm: () => {
              initState(state.sport);
              updateFullUI();
            },
          })
        );
        document
          .getElementById("start-pause-btn")
          .addEventListener("click", toggleTimer);
        document
          .getElementById("settings-btn")
          .addEventListener("click", openSettingsModal);
        document
          .getElementById("share-btn")
          .addEventListener("click", openShareModal);
        document
          .getElementById("team-a-name")
          .addEventListener("change", (e) => {
            state.teamAName = e.target.value;
            updateFullUI();
          });
        document
          .getElementById("team-b-name")
          .addEventListener("change", (e) => {
            state.teamBName = e.target.value;
            updateFullUI();
          });

        // Modals
        document
          .getElementById("country-btn-a")
          .addEventListener("click", () => {
            playSound("click");
            openCountryModal("a");
          });
        document
          .getElementById("country-btn-b")
          .addEventListener("click", () => {
            playSound("click");
            openCountryModal("b");
          });
        countryModal.addEventListener("click", (e) => {
          if (e.target === countryModal) closeModal(countryModal);
        });
        document
          .getElementById("country-search")
          .addEventListener("input", (e) =>
            populateCountryList(e.target.value)
          );
        document
          .getElementById("confirm-cancel-btn")
          .addEventListener("click", () => {
            playSound("click");
            closeModal(confirmModal);
          });
        document
          .getElementById("confirm-ok-btn")
          .addEventListener("click", () => {
            if (confirmCallback) {
              confirmCallback();
            }
            closeModal(confirmModal);
          });
        document
          .getElementById("settings-cancel-btn")
          .addEventListener("click", () => {
            playSound("click");
            closeModal(settingsModal);
          });
        document
          .getElementById("settings-save-btn")
          .addEventListener("click", saveSettings);
        document
          .getElementById("history-close-btn")
          .addEventListener("click", () => {
            playSound("click");
            closeModal(historyModal);
          });
        document
          .getElementById("share-close-btn")
          .addEventListener("click", () => {
            playSound("click");
            closeModal(shareModal);
          });
        document
          .getElementById("share-copy-btn")
          .addEventListener("click", () => {
            playSound("click");
            const config = sportConfigs[state.sport];
            const finalScoreText = config.hasSets
              ? `${state.setsA} - ${state.setsB}`
              : `${state.scoreA} - ${state.scoreB}`;
            const text = `Hasil Pertandingan ${config.title}: ${state.teamAName} ${finalScoreText} ${state.teamBName}`;
            navigator.clipboard
              .writeText(text)
              .then(() => alert("Teks disalin!"));
          });

        // Keyboard Shortcuts
        document.addEventListener("keydown", (e) => {
          const isModalOpen = Array.from(
            document.querySelectorAll(".modal-backdrop")
          ).some((m) => m.classList.contains("show"));
          if (document.activeElement.tagName === "INPUT" || isModalOpen) return;
          if (scoreboardWrapper.classList.contains("hidden")) return;
          if (["ArrowLeft", "ArrowRight", "Delete"].includes(e.key))
            e.preventDefault();
          switch (e.key) {
            case "ArrowLeft":
              addScore("a", 1);
              break;
            case "ArrowRight":
              addScore("b", 1);
              break;
            case "Delete":
              document.getElementById("reset-btn").click();
              break;
          }
        });

        if (loadState() && state.sport) {
          const resumeText = document.getElementById("resume-text");
          resumeText.textContent = `Pertandingan terakhir (${
            sportConfigs[state.sport].title
          }) siap dilanjutkan.`;
          resumeText.classList.remove("hidden");
        }
      });
    </script>
  </body>
</html>
ÔøΩ
